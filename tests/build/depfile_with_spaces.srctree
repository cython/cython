"""
CYTHONIZE -M 'folder with spaces/foo.pyx'
PYTHON check.py
"""

######## folder with spaces/foo.pyx ########

from bar cimport empty

include "baz with spaces.pxi"

empty()
print(foo())


######## folder with spaces/baz with spaces.pxi ########

from cython.cimports.libc.math import sin

def foo():
    return "foo"

print(sin(0))

######## folder with spaces/bar.pxd ########

cdef inline void empty():
    print("empty")


######## check.py ########
import os

with open("folder with spaces/foo.c.dep", "r") as f:
    contents = f.readlines()
    contents = [c.replace(f'..{os.sep}', '').lstrip().rstrip(" \\\n") for c in contents]

assert sorted(contents) == [
    os.path.join("Cython", "Includes", "libc", "math.pxd"),
    os.path.join("folder with spaces", "foo.c:"),
    os.path.join("folder\\ with\\ spaces", "bar.pxd"),
    os.path.join("folder\\ with\\ spaces", "baz\\ with\\ spaces.pxi"),
    os.path.join("folder\\ with\\ spaces", "foo.pyx"),
], sorted(contents)
