PYTHON setup.py build_ext --inplace
PYTHON -c "import bar"
PYTHON -c "import aa; assert aa.Klass().m() == 5"

######## setup.py ########

from Cython.Build.Dependencies import cythonize
from distutils.core import setup

setup(
  ext_modules = cythonize(["*.pyx", "*.py"], compiler_directives={'legacy_implicit_noexcept': True}),
)


######## bar.pyx ########

cdef int func_noexcept() noexcept:
    raise RuntimeError()

cdef int func_implicit():
    raise RuntimeError()

cdef int func_return_value() except -1:
    raise RuntimeError()

func_noexcept()
func_implicit()

try:
    func_return_value()
except RuntimeError:
    pass
else:
    assert False, 'Exception not raised'


######## aa.pxd ########
cdef class Klass:
    cpdef int m(self) except? -1


######## aa.py ########

class Klass:

    def m(self):
        return 5
